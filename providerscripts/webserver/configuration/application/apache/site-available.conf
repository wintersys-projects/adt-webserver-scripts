
# Hide server version on error pages
ServerSignature Off

#XXXXMODSECURITYXXXXSecRuleEngine On
#XXXXMODSECURITYXXXXIncludeOptional /etc/modsecurity/*.conf
#XXXXMODSECURITYXXXXInclude /etc/modsecurity/rules/*.conf

SSLSessionCache "shmcb:/var/log/apache2/ssl_scache(512000)"
ServerName XXXXWEBSITEURLXXXX


<VirtualHost *:443>
 ServerAdmin webmaster@XXXXROOTDOMAINXXXX
 DocumentRoot /var/www/html

 SSLEngine on

 SSLCertificateFile       XXXXHOMEXXXX/ssl/live/XXXXWEBSITEURLXXXX/fullchain.pem
 SSLCertificateKeyFile    XXXXHOMEXXXX/ssl/live/XXXXWEBSITEURLXXXX/privkey.pem
 SSLCACertificateFile /etc/ssl/certs/ca-certificates.crt
 
 SSLProtocol -ALL +TLSv1.2 +TLSv1.3

 # Compilation of the top cipher suites 2024
 # https://ssl-config.mozilla.org/#server=apache
 SSLCipherSuite ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-CHACHA20-POLY1305
 
 SSLHonorCipherOrder on
 SSLCompression off
 SSLSessionTickets off

 # Enable SSL session caching for improved performance
 SSLSessionCacheTimeout 300
 SSLOpenSSLConfCmd DHParameters "/etc/ssl/certs/dhparam.pem"
 
 # Security headers
 ## X-Content-Type-Options
 Header set X-Content-Type-Options "nosniff"
    
 ## Content-Security-Policy
 Header set Content-Security-Policy "frame-ancestors 'self';"
    
 ## Strict Transport Security (HSTS)
 Header set Strict-Transport-Security "max-age=31536000; includeSubdomains; preload"

 #XXXXFASTCGISOCKETXXXX<FilesMatch \.php$>
 #XXXXFASTCGISOCKETXXXX   <If "-f %{REQUEST_FILENAME}">
 #XXXXFASTCGISOCKETXXXX    SetHandler "proxy:unix:/var/run/php/phpXXXXPHPVERSIONXXXX-fpm|fcgi://localhost"
 #XXXXFASTCGISOCKETXXXX   </If>
 #XXXXFASTCGISOCKETXXXX</FilesMatch>

 #XXXXFASTCGIPORTXXXX<FilesMatch ".+\.php$">
 #XXXXFASTCGIPORTXXXX    <If "-f %{REQUEST_FILENAME}">
 #XXXXFASTCGIPORTXXXX        SetHandler proxy:fcgi://localhost:XXXXPORTXXXX   
 #XXXXFASTCGIPORTXXXX    </If>
 #XXXXFASTCGIPORTXXXX</FilesMatch>

 DirectoryIndex index.php index.html

 #XXXXJOOMLAXXXX <Directory /var/www/html>
 #XXXXJOOMLAXXXX        Options +FollowSymlinks -Includes -ExecCGI -Indexes
 #XXXXJOOMLAXXXX        AllowOverride All
 #XXXXJOOMLAXXXX        Require all granted
 #XXXXJOOMLAXXXX #XXXXBASIC-AUTHXXXXAuthType Basic
 #XXXXJOOMLAXXXX #XXXXBASIC-AUTHXXXXAuthName "Visit XXXXWEBSITE_URLXXXXX to generate a new password if you need to"
 #XXXXJOOMLAXXXX #XXXXBASIC-AUTHXXXXAuthUserFile /etc/apache2/.htpasswd
 #XXXXJOOMLAXXXX #XXXXBASIC-AUTHXXXX<RequireAny>
 #XXXXJOOMLAXXXX #XXXXBASIC-AUTHXXXXRequire ip XXXXVPC_IP_RANGEXXXX XXXXBUILD_MACHINE_IPXXXX
 #XXXXJOOMLAXXXX #XXXXBASIC-AUTHXXXXRequire valid-user
 #XXXXJOOMLAXXXX #XXXXBASIC-AUTHXXXX</RequireAny>
 #XXXXJOOMLAXXXX</Directory>

 #XXXXWORDPRESSXXXX <Directory /var/www/html>
 #XXXXWORDPRESSXXXX        Options +FollowSymlinks -Includes -ExecCGI -Indexes
 #XXXXWORDPRESSXXXX        AllowOverride All
 #XXXXWORDPRESSXXXX        Require all granted
 #XXXXWORDPRESSXXXX #XXXXBASIC-AUTHXXXXAuthType Basic
 #XXXXWORDPRESSXXXX #XXXXBASIC-AUTHXXXXAuthName "Visit XXXXWEBSITE_URLXXXXX to generate a new password if you need to"
 #XXXXWORDPRESSXXXX #XXXXBASIC-AUTHXXXXAuthUserFile /etc/apache2/.htpasswd
 #XXXXWORDPRESSXXXX #XXXXBASIC-AUTHXXXX<RequireAny>
 #XXXXWORDPRESSXXXX #XXXXBASIC-AUTHXXXXRequire ip XXXXVPC_IP_RANGEXXXX XXXXBUILD_MACHINE_IPXXXX
 #XXXXWORDPRESSXXXX #XXXXBASIC-AUTHXXXXRequire valid-user
 #XXXXWORDPRESSXXXX #XXXXBASIC-AUTHXXXX</RequireAny>
 #XXXXWORDPRESSXXXX</Directory>

 #XXXXDRUPALXXXX<Directory /var/www/html/sites/default/files/>
 #XXXXDRUPALXXXX        Options +FollowSymlinks -Includes -ExecCGI -Indexes
 #XXXXDRUPALXXXX        AllowOverride All
 #XXXXDRUPALXXXX        Require all granted
 #XXXXDRUPALXXXX </Directory>

 #XXXXDRUPALXXXX <Directory /var/www/html>
 #XXXXDRUPALXXXX        Options +FollowSymlinks -Includes -ExecCGI -Indexes
 #XXXXDRUPALXXXX        AllowOverride All
 #XXXXDRUPALXXXX        Require all granted
 #XXXXDRUPALXXXX		RewriteEngine on
 #XXXXDRUPALXXXX		RewriteBase /
 #XXXXDRUPALXXXX		RewriteCond %{REQUEST_FILENAME} !-f
 #XXXXDRUPALXXXX		RewriteCond %{REQUEST_FILENAME} !-d
 #XXXXDRUPALXXXX		RewriteRule ^(.*)$ index.php?q=$1 [L,QSA]
 #XXXXDRUPALXXXX</Directory>

 #XXXXMOODLEXXXX <Directory /var/www/html>
 #XXXXMOODLEXXXX      DirectoryIndex index.php
 #XXXXMOODLEXXXX      LimitRequestBody 512000
 #XXXXMOODLEXXXX      LimitXMLRequestBody 10485760
 #XXXXMOODLEXXXX      AllowOverride ALL
 #XXXXMOODLEXXXX      Options -Includes -ExecCGI -Indexes 
 #XXXXMOODLEXXXX      Require all granted
 #XXXXMOODLEXXXX   </Directory>
        
 #XXXXMOODLEXXXX   <Directory /var/www/html/moodledata>
 #XXXXMOODLEXXXX      Require all denied
 #XXXXMOODLEXXXX   </Directory>
 
 # Log
 ErrorLog ${APACHE_LOG_DIR}/error.log
 CustomLog ${APACHE_LOG_DIR}/access.log combined
</VirtualHost>
