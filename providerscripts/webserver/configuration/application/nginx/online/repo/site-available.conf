
map $http_user_agent $blockedagent {
default         0;
~*malicious     1;
~*bot           1;
~*backdoor      1;
~*crawler       1;
~*bandit        1;
}

#XXXXPHPPORTXXXXupstream php {
#XXXXPHPPORTXXXX    server 127.0.0.1:XXXXPORTXXXX;
#XXXXPHPPORTXXXX    keepalive_timeout 65;
#XXXXPHPPORTXXXX}

server {
    listen    80;
  #  listen   [::]:80 ssl;
    http2 on;
    server_name XXXXWEBSITEURLXXXX;
    return 301 https://$host$request_uri;
}

server
{
    if ($blockedagent)
    {
        return 403;
    }

    #https://forum.hestiacp.com/t/nginx-1-25-1-listen-http2-directive-is-deprecated/9816
    listen    443 ssl;
  #  listen    [::]:443 ssl;
    http2 on;
    server_name XXXXWEBSITEURLXXXX;
    root /var/www/html;
    index index.php index.html;
    
    ssl_certificate XXXXHOMEXXXX/ssl/live/XXXXWEBSITEURLXXXX/fullchain.pem;
    ssl_certificate_key XXXXHOMEXXXX/ssl/live/XXXXWEBSITEURLXXXX/privkey.pem;
    ssl_trusted_certificate XXXXHOMEXXXX/ssl/live/XXXXWEBSITEURLXXXX/fullchain.pem;

	# security headers
	add_header X-Frame-Options SAMEORIGIN;
	add_header X-XSS-Protection          "1; mode=block" always;
	add_header X-Content-Type-Options    "nosniff" always;
	add_header Referrer-Policy           "no-referrer-when-downgrade" always;
	add_header Content-Security-Policy   "default-src 'self' http: https: ws: wss: data: blob: 'unsafe-inline'; frame-ancestors 'self';" always;
	add_header Permissions-Policy        "interest-cohort=()" always;
	add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
	ssl_dhparam /etc/ssl/certs/dhparam.pem;

#XXXXBASIC-AUTHXXXXsatisfy any;
#XXXXBASIC-AUTHXXXXallow 127.0.0.1;
#XXXXBASIC-AUTHXXXXallow XXXXVPC_IP_RANGEXXXX;
#XXXXBASIC-AUTHXXXXallow XXXXBUILD_MACHINE_IPXXXX;
#XXXXBASIC-AUTHXXXXdeny all;
#XXXXBASIC-AUTHXXXXauth_basic           "Visit XXXXWEBSITEURLXXXXX to generate a new password if you need to";
#XXXXBASIC-AUTHXXXXauth_basic_user_file /etc/nginx/.htpasswd;

	if ($request_method !~ ^(GET|HEAD|POST)$)
	{
		return 444;
	}

	location = /favicon.ico 
	{
		log_not_found off;
		access_log off;
	}

	location = /robots.txt 
	{
		allow all;
		log_not_found off;
		access_log off;
	}

	# Deny all attempts to access hidden files such as .htpasswd.
    location ~ /\. 
    {
        deny all;
        access_log off;
        log_not_found off;
    }

	# assets, media
	location ~* \.(?:css(\.map)?|js(\.map)?|jpe?g|png|gif|ico|cur|heic|webp|tiff?|mp3|m4a|aac|ogg|midi?|wav|mp4|mov|webm|mpe?g|avi|ogv|flv|wmv)$ 
	{
    	expires max;
		log_not_found off;
	}

	# svg, fonts
	location ~* \.(?:svgz?|ttf|ttc|otf|eot|woff2?)$ 
	{
    	add_header Access-Control-Allow-Origin "*";
    	expires    7d;
	}

    location / 
    {
        try_files $uri $uri/ /index.php?$args;
    }


#XXXXJOOMLAXXXX  #Joomla specific settings
#XXXXJOOMLAXXXX    # deny running scripts inside writable directories
#XXXXJOOMLAXXXX     location ~* /(images|cache|media|logs|tmp)/.*\.(php|pl|py|jsp|asp|sh|cgi)$ {
#XXXXJOOMLAXXXX         return 403;
#XXXXJOOMLAXXXX         error_page 403 /403_error.html;
#XXXXJOOMLAXXXX     }

#XXXXJOOMLAXXXX     # caching of files 
#XXXXJOOMLAXXXX     location ~* \.(ico|pdf|flv)$ {
#XXXXJOOMLAXXXX         expires 1y;
#XXXXJOOMLAXXXX     }


#XXXXJOOMLAXXXX     # Support API
#XXXXJOOMLAXXXX     location /api/ {
#XXXXJOOMLAXXXX 	try_files $uri $uri/ /api/index.php?$args;
#XXXXJOOMLAXXXX     }



#XXXXWORDPRESSXXXX #Wordpress specific settings
#XXXXWORDPRESSXXXXlocation ~* ^/(?:wp-content|wp-includes)/.*\.php$ {
#XXXXWORDPRESSXXXX    deny all;
#XXXXWORDPRESSXXXX}

#XXXXWORDPRESSXXXXlocation ~* ^/wp-content/uploads/.*\.(?:s?html?|php|js|swf)$ {
#XXXXWORDPRESSXXXX    deny all;
#XXXXWORDPRESSXXXX}

#XXXXWORDPRESSXXXXlocation ~* ^/wp-content/plugins/wordpress-seo(?:-premium)?/css/main-sitemap\.xsl$ {}

#XXXXWORDPRESSXXXXlocation ~ ^/wp-content/plugins {
#XXXXWORDPRESSXXXX    deny all;
#XXXXWORDPRESSXXXX}

#XXXXWORDPRESSXXXXlocation ~* ^/(?:xmlrpc\.php|wp-links-opml\.php|wp-config\.php|wp-config-sample\.php|readme\.html|license\.txt)$ {
#XXXXWORDPRESSXXXX    deny all;
#XXXXWORDPRESSXXXX}



#XXXXPHPPORTXXXXlocation ~ \.php$     
#XXXXPHPPORTXXXX{
#XXXXPHPPORTXXXXinclude /etc/nginx/fastcgi.conf;
#XXXXPHPPORTXXXXfastcgi_intercept_errors on;
#XXXXPHPPORTXXXXfastcgi_read_timeout 300s;
#XXXXPHPPORTXXXXfastcgi_pass php;
#XXXXPHPPORTXXXX}

#XXXXPHPSOCKETXXXXlocation ~ [^/]\.php(/|$) {
#XXXXPHPSOCKETXXXX        fastcgi_split_path_info ^(.+?\.php)(/.*)$;
#XXXXPHPSOCKETXXXX        if (!-f $document_root$fastcgi_script_name) {
#XXXXPHPSOCKETXXXX                return 404;
#XXXXPHPSOCKETXXXX        }
#XXXXPHPSOCKETXXXX        fastcgi_pass unix:/var/run/phpXXXXPHPVERSIONXXXX-fpm.sock;
#XXXXPHPSOCKETXXXX        fastcgi_index index.php;
#XXXXPHPSOCKETXXXX        include /etc/nginx/fastcgi_params;
#XXXXPHPSOCKETXXXX        fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
#XXXXPHPSOCKETXXXX        include /etc/nginx/fastcgi.conf;
#XXXXPHPSOCKETXXXX}

}
